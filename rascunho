
def carregar_dados_remessa_santander(codigo_doc=None):
    try:
        # Conexão com o banco de dados
        mydb = mysql.connector.connect(
            host='db_sabertrimed.mysql.dbaas.com.br',
            user='db_sabertrimed',
            password='s@BRtR1m3d',  
            database='db_sabertrimed',
        )
        consulta_remessa = """
        SELECT 
            `Data da Gravação do Arquivo`,
            `Código de movimento remessa`,   
            `CODIGO DO DOC`,    
            `Data de vencimento do boleto`,	    
            `Valor nominal do boleto`,    
            `Nome do Pagador`,	    
            `Data do desconto 2`,
            `Percentual de Multa`,
            `Data da Multa`,
            `Data Limite para concessão do desconto`,
            `Valor do desconto a ser concedido`,
            `Nº Sequencial do Registro`,
            `Data de emissão do boleto`,
            `Percentual do IOF a ser recolhido`,
            `Número de dias corridos para Protesto`,	
            `Número sequencial do registro no arquivo`,
            `Número sequencial de registro no arquivo trailer`

          FROM remessa_santander            
                """
        if codigo_doc:
            consulta_remessa += " WHERE `CODIGO DO DOC` = %s"
            remessasantander_bd = pd.read_sql(consulta_remessa, con=mydb, params=[codigo_doc])
            

            remessasantander_bd = remessasantander_bd.loc[remessasantander_bd['CODIGO DO DOC'].notnull() & (remessasantander_bd['CODIGO DO DOC'] != "")]
            novos_nomes = {
                'Data da Gravação do Arquivo': 'Data da Ocorrencia',
                'Código de movimento remessa': 'Ocorrencia',
                # ... adicione os outros nomes conforme necessário
            }
            remessasantander_bd.rename(columns=novos_nomes, inplace=True)

            remessasantander_bd = remessasantander_bd.sort_values(by='Data da Ocorrencia', ascending=True)       
        else:
            remessasantander_bd = pd.read_sql(consulta_remessa, con=mydb).head(10)
            remessasantander_bd = remessasantander_bd.loc[remessasantander_bd['CODIGO DO DOC'].notnull() & (remessasantander_bd['CODIGO DO DOC'] != "")]
            novos_nomes = {
                'Data da Gravação do Arquivo': 'Data da Ocorrencia',
                'Código de movimento remessa': 'Ocorrencia',
                # ... adicione os outros nomes conforme necessário
            }
            remessasantander_bd.rename(columns=novos_nomes, inplace=True)

            remessasantander_bd = remessasantander_bd.sort_values(by='Data da Ocorrencia', ascending=True)       
            mydb.close()

        return remessasantander_bd
    except mysql.connector.Error as e:
        print("Erro ao conectar-se ao banco de dados:", e)
        return pd.DataFrame()
    

    @login_required(login_url='login')  # Redireciona para a página de login se o usuário não estiver autenticad
def sofisa_view(request):
    codigo_doc_sofisa = request.GET.get('codigo_doc_sofisa')
    remessa_data = carregar_dados_remessa_sofisa(codigo_doc_sofisa)
    retorno_data = carregar_dados_retorno_sofisa(codigo_doc_sofisa)

    context = {
        'remessa': remessa_data.to_dict(orient='records'),
        'retorno': retorno_data.to_dict(orient='records'),
        'codigo_doc_sofisa': codigo_doc_sofisa,

    }

    return render(request, 'sofisa.html', context)


